image: node:latest

before_script:
  - mkdir -p ~/.ssh && echo -e "${SSH_PRIVATE_KEY}" > ~/.ssh/id_rsa && chmod og-rwx ~/.ssh/id_rsa
#  - echo "$SSH_PRIVATE_KEY" | ssh-add - > /dev/null
  - mkdir -p ~/.ssh && touch ~/.ssh/known_hosts
  - echo "$SSH_KNOWN_HOSTS" >> ~/.ssh/known_hosts
  - npm install --unsafe-perm
  - git clone https://github.com/zazuko/ssz-views.git && cd ssz-views && npm install
  - cd $CI_PROJECT_DIR

cache:
  paths:
    - node_modules/

pipeline_prod:
  only:
    - master
  environment:
    name: PROD
  script:
    - npm run fetch
    - npm run output:store

pipeline_int:
  only:
    - develop
  tags:
    - medium
  except:
    variables:
      - $RELEASE == "zazuko"
  environment:
    name: INT
  script:
    - ./scripts/main.sh
  #  - npm run fetch
  #  - npm run output:store

pipeline_test:
  only:
    variables:
      - $RELEASE == "zazuko"
  environment:
    name: TEST
  script:
    - npm run fetch
    - npm run output:store